<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Công Cụ Tính Phí Bảo Hiểm</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #fff;
        padding: 10px;
        max-width: 900px;
        margin: auto;
        color: #003d7c;
      }
      h2 {
        text-align: center;
      }
      h3 {
        text-align: left;
        margin-top: 20px;
      }
      .section {
        margin-bottom: 15px;
        border-bottom: 1px solid #ccc;
        padding-bottom: 15px;
      }
      .row {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        margin-top: 10px;
      }
      .row label {
        width: 250px;
      }
      .row input {
        flex: 1;
        padding: 5px;
        width: 200px;
      }
      label {
        display: inline-block;
        margin-top: 10px;
      }
      input {
        margin: 5px;
        box-sizing: border-box;
      }
      .bold {
        font-weight: bold;
      }
      .result {
        color: red;
      }
      .description {
        font-size: 0.9em;
        margin: 4px 0 10px 0;
        color: #333;
      }
      .header {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
        margin-bottom: 10px;
        flex-wrap: wrap;
      }
      .header img {
        width: 200px;
      }

      @media (max-width: 768px) {
        .header {
          flex-direction: column;
          align-items: flex-start;
        }
        .header img {
          margin-bottom: 0px;
        }
        .age-job-row {
          flex-direction: column;
          flex-wrap: wrap;
          align-items: flex-start;
        }
        .age-job-row > div {
          width: 100%;
          display: flex;
          align-items: center;
          margin-bottom: 5px;
        }
        .age-job-row label {
          width: auto;
          margin-right: 10px;
        }
        .age-job-row input {
          width: 100%;
        }
      }

      @media (min-width: 769px) {
        .header img {
          position: absolute;
          top: 20px;
          left: 20px;
        }
        .age-job-row input {
          width: auto;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div>
        <img src="img/logo.png" alt="Logo Bảo Việt"/>
      </div>
      <div style="padding-top: 20px; margin-left: 10px;">
        <h2 style="margin-top: 0px; margin-bottom: 10px;">CÔNG CỤ TÍNH PHÍ SẢN PHẨM BẢO HIỂM BỔ TRỢ</h2>
        <p style="text-align: center; margin-bottom: 40px;">Phát triển bởi AD Đỗ Minh Trí - BVNT Vĩnh Phúc</p>
      </div>
    </div>
    <div class="section">
        <div class="row age-job-row" style="gap: 20px;">
          <div>
          <label style="width: auto;">Tuổi NĐBH:</label>
          <input type="number" id="age"/>
          </div>
          <div>
          <label style="width: auto;">Nhóm nghề NĐBH:</label>
          <input type="number" id="jobGroup"/>
          </div>
        </div>
    </div>

    <div class="section">
        <h3>R21 - Bệnh nan y: Ung thư/Đột quỵ/Nhồi máu cơ tim</h3>
        <div class="description">STBH tối thiểu 100 triệu, tối đa bằng STBH TV</br>Từ 18-74 tuổi</div>
        <div class="row" style="gap: 10px;">
          <label style="width: auto;">Số tiền bảo hiểm:</label>
          <input class="amount-input" type="text" id="r21_amount" style="width: 150px;" />
          <label style="width: auto;">Số năm đóng phí:</label>
          <input type="number" id="r21_years" style="width: 100px;" />
        </div>
        <label class="bold">Tổng phí:</label>
        <span id="r21_total" class="result">#</span>
        <span id="r21_note" style="color: red; font-size: 0.9em; margin-left: 10px;"></span>
    </div>

    <div class="section">
        <h3>R22 - Thương tật bộ phận vĩnh viễn do tai nạn</h3>
        <div class="description">STBH từ 200 triệu đến 500 triệu</br>Từ 0-69 tuổi, NĐBH thuộc nhóm 1,2,3,4</div>
        <div class="row" style="gap: 10px;">
          <label style="width: auto;">Số tiền bảo hiểm:</label>
          <input class="amount-input" type="text" id="r22_amount" style="width: 150px;" />
          <label style="width: auto;">Số năm đóng phí:</label>
          <input type="number" id="r22_years" style="width: 100px;" />
        </div>
        <label class="bold">Tổng phí:</label>
        <span id="r22_total" class="result">#</span>
        <span id="r22_note" style="color: red; font-size: 0.9em; margin-left: 10px;"></span>
    </div>

    <div class="section">
        <h3>R23 - Tử vong và thương tật nghiêm trọng do tai nạn</h3>
        <div class="description">STBH từ 100 triệu, tối đa bằng STBH TV</br>Từ 0-69 tuổi, NĐBH thuộc nhóm 1,2,3,4,5</div>
        <div class="row" style="gap: 10px;">
          <label style="width: auto;">Số tiền bảo hiểm:</label>
          <input class="amount-input" type="text" id="r23_amount" style="width: 150px;" />
          <label style="width: auto;">Số năm đóng phí:</label>
          <input type="number" id="r23_years" style="width: 100px;" />
        </div>
        <label class="bold">Tổng phí:</label>
        <span id="r23_total" class="result">#</span>
        <span id="r23_note" style="color: red; font-size: 0.9em; margin-left: 10px;"></span>
    </div>

    <div class="section">
        <label class="bold">TỔNG PHÍ BẢO HIỂM SẢN PHẨM BỔ TRỢ DỰ KIẾN THAM GIA:</label>
        <span id="total" class="result">#</span>
    </div>

    <script>
        const r21Table = {
          18: 51200, 19: 54200, 20: 57000, 21: 60200, 22: 65200, 23: 72500,
          24: 80000, 25: 89000, 26: 98500, 27: 108500, 28: 119200, 29: 130200,
          30: 142700, 31: 156200, 32: 174500, 33: 199200, 34: 227200, 35: 258700,
          36: 290900, 37: 308300, 38: 321600, 39: 368700, 40: 422200, 41: 477000,
          42: 529300, 43: 587600, 44: 654500, 45: 731500, 46: 818000, 47: 912800,
          48: 1010700, 49: 1104300, 50: 1190300, 51: 1310600, 52: 1409900, 53: 1481700,
          54: 1559600, 55: 1641700, 56: 1725700, 57: 1848800, 58: 2020100, 59: 2211300,
          60: 2421600, 61: 2648700, 62: 2862300, 63: 3050000, 64: 3242600, 65: 3442600,
          66: 3647700, 67: 3908700, 68: 4203200, 69: 4451900, 70: 4843300, 71: 5295600,
          72: 5666300, 73: 6062900, 74: 6487300
        };

        const r23Table = {
          1: 21600, 2: 32400, 3: 43200, 4: 54000, 5: 54000, 6: 54000, 7: 54000,
          8: 54000, 9: 54000, 10: 54000, 11: 54000, 12: 54000, 13: 54000, 14: 54000,
          15: 54000, 16: 54000, 17: 54000, 18: 88200, 19: 88200, 20: 88200, 21: 88200,
          22: 88200, 23: 88200, 24: 88200, 25: 88200, 26: 88200, 27: 88200, 28: 88200,
          29: 88200, 30: 68700, 31: 68700, 32: 68700, 33: 68700, 34: 68700, 35: 68700,
          36: 68700, 37: 68700, 38: 68700, 39: 68700, 40: 83800, 41: 83800, 42: 83800,
          43: 83800, 44: 83800, 45: 83800, 46: 83800, 47: 83800, 48: 83800, 49: 83800,
          50: 112400, 51: 112400, 52: 112400, 53: 112400, 54: 112400, 55: 112400,
          56: 112400, 57: 112400, 58: 112400, 59: 112400, 60: 109800, 61: 109800,
          62: 109800, 63: 109800, 64: 109800, 65: 109800, 66: 109800, 67: 109800,
          68: 109800, 69: 109800
        };

        const rateR22 = { 1: 1, 2: 1.3, 3: 1.9, 4: 2.5 };
        const rateR23 = { 1: 1, 2: 1.3, 3: 1.9, 4: 2.5, 5: 3.5 };

        function calculatePremiumR21(age, amount, years) {
          let total = 0;
          for (let i = 0; i < years; i++) {
            const fee = r21Table[age + i];
            if (fee) total += fee;
          }
          return (total * amount) / 100000000;
        }

        function calculatePremiumR22(group, amount, years) {
          if (group === 5 || group === 6) return null;
          const rate = rateR22[group];
          //if (!rate) return null;
          return (102000 * years * rate * amount) / 200000000;
        }

        function calculatePremiumR23(age, group, amount, years) {
          if (group === 6) return null;
          const rate = rateR23[group];
          //if (!rate) return null;
          let total = 0;
          for (let i = 0; i < years; i++) {
            const fee = r23Table[age + i];
            if (fee) total += fee;
          }
          return (total * amount * rate) / 100000000;
        }

        function calculateTotal() {
          const age = parseInt(document.getElementById("age").value);
          const group = parseInt(document.getElementById("jobGroup").value);
          //const r21Amount = parseInt(document.getElementById("r21_amount").value);
          const r21Years = parseInt(document.getElementById("r21_years").value);
          //const r22Amount = parseInt(document.getElementById("r22_amount").value);
          const r22Years = parseInt(document.getElementById("r22_years").value);
          //const r23Amount = parseInt(document.getElementById("r23_amount").value);
          const r23Years = parseInt(document.getElementById("r23_years").value);
          const r21Amount = getNumberValue("r21_amount");
          const r22Amount = getNumberValue("r22_amount");
          const r23Amount = getNumberValue("r23_amount");

          // R21
          let r21Total = 0;
          if (age < 18 || age > 74) {
            document.getElementById("r21_total").innerText = "N/A";
            document.getElementById("r21_note").innerText = "※ Độ tuổi không được bảo hiểm";
          } else if (!r21Amount || !r21Years) {
            document.getElementById("r21_total").innerText = "#";
            document.getElementById("r21_note").innerText = "";
          } else {
            document.getElementById("r21_note").innerText = "";
            r21Total = calculatePremiumR21(age, r21Amount, r21Years);
            document.getElementById("r21_total").innerText = r21Total.toLocaleString();
          }

          // R22
          const r22Total = calculatePremiumR22(group, r22Amount, r22Years);
          if (r22Total === null) {
            document.getElementById("r22_total").innerText = "N/A";
            document.getElementById("r22_note").innerText = "※ Nhóm nghề không được bảo hiểm";
          } else if (!r22Amount || !r22Years) {
            document.getElementById("r22_total").innerText = "#";
            document.getElementById("r22_note").innerText = "";
          } else {
            document.getElementById("r22_note").innerText = "";
            document.getElementById("r22_total").innerText = r22Total.toLocaleString();
          }

          // R23
          const r23Total = calculatePremiumR23(age, group, r23Amount, r23Years);
          if (r23Total === null) {
            document.getElementById("r23_total").innerText = "N/A";
            document.getElementById("r23_note").innerText = "※ Nhóm nghề không được bảo hiểm";
          } else if (!r23Amount || !r23Years) {
            document.getElementById("r23_total").innerText = "#";
            document.getElementById("r23_note").innerText = "";
          } else {
            document.getElementById("r23_note").innerText = "";
            document.getElementById("r23_total").innerText = r23Total.toLocaleString();
          }

          const total = (r21Total || 0) + (r22Total || 0) + (r23Total || 0);
          document.getElementById("total").innerText = total.toLocaleString();
        }

        document.querySelectorAll(".amount-input").forEach((el) => {
          el.addEventListener("input", (e) => {
          const cursorPos = el.selectionStart;
          const raw = el.value.replace(/,/g, "").replace(/\D/g, "");
          const formatted = Number(raw).toLocaleString("en-US");
          el.value = formatted;

          // Cập nhật lại vị trí con trỏ
          const diff = formatted.length - raw.length;
          el.setSelectionRange(cursorPos + diff, cursorPos + diff);

          //calculateTotal(); // Gọi lại hàm tính
        });
        });

        // Hàm tiện ích để lấy giá trị số từ chuỗi có dấu phẩy
        function getNumberValue(id) {
          const raw = document.getElementById(id).value.replace(/,/g, "");
          return parseInt(raw) || 0;
        }

        document.querySelectorAll("input").forEach(input => {
          input.addEventListener("input", calculateTotal);
        });

        window.onload = calculateTotal;

    </script>
  </body>
</html>
